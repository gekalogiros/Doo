language: go
go:
- '1.11'

before_install:
- go get github.com/mitchellh/gox

install:
- go get -t -v ./...

script:
- diff -u <(echo -n) <(gofmt -d .)
- go vet $(go list ./... | grep -v /vendor/)
- go test -v -race ./...
- gox -os="darwin" -arch="amd64" -output="doo.{{.OS}}.{{.Arch}}" -ldflags "-X main.Rev=`git rev-parse --short HEAD`" -verbose ./...

deploy:
  provider: releases
  api_key:
    secure: fMxJ2FYYkg8woEYtqFyoDyjh8OgOsyQL5/y2Wwt/4MBfLBgcItySM2SvAivPgrGxB+8umNiUyMrMRvXFUv4f/C9KzFXR2uAvF0Tibub6zc2FaAifBo95qFDDy56EA1ogTNTVpkTca1oi2Qsd9Tbsyzmu/YiqsMk/8Dx6ZAUFeW0jSPph3sCXiijODHvDDMNYcUxc0PoZ0xG6zwLR5RYk/Cj1XNwR+t66qKjX0pmvy97RWbfLvEkRjX6963EQBKzFXNEyvxmt5roXYZNPCHORROM7tb1jAM+kTnaXjHTJVTz+Y+nwDZgEnp5gn+GdkG3BCpBCzwwDp5rinhIEGCW6/KzMUpSCCnCBSlwWhlaWMgwD0+LYtKRwr1z/Ay5QeccdgSX0EPEUA3IfdfUBhy5AXv8joUNXWn0EnscZOG5rqfM/EkjwGNxul75U6+PEVu90XYtKjDh+zan+W0rhY85v+4JuaDxGj2u1fzf6sfc45UUSdx2mAUzEnSz+o7cNF85Ue9oOev3S41T/FhMzCt524hDLiig0T3REGU79l9YydhT+1ZMyBYr6iVpMJKrsNXvgZVO2LtmewiGBb5kwjI8XaqC92OUhzYam1zdvn8alQ9Gg7eBLa8IsCJ8uQAlE/xM/zw3zZoNxxfENBrQGxbk7/wI6K0IH5T7ysi/Y4xDYyXE=
  file: 'doo.darwin.amd64'
  skip_cleanup: true
  on:
    repo: gekalogiros/Doo
    tags: true
